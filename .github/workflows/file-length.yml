# File Length Check - Enforce documentation organization guidelines
#
# Warns when files exceed recommended line limits:
# - 200 lines: Recommended maximum, consider refactoring
# - 300 lines: Hard warning, should definitely be split
#
# Helps maintain the "target 200 lines max per file" guideline
# documented in CLAUDE.md section 5.

name: File Length Check

on:
  pull_request:
    paths:
      - '**.md'
      - '**.nix'

jobs:
  check:
    name: Check File Lengths
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Check file lengths
        run: |
          MAX_RECOMMENDED=200
          MAX_HARD=300
          WARNINGS=0
          ERRORS=0

          echo "Checking file lengths (target: $MAX_RECOMMENDED lines)..."
          echo ""

          # Check markdown files
          echo "=== Markdown Files ==="
          for f in $(find . -name "*.md" -not -path "./node_modules/*" -not -path "./.git/*" | sort); do
            lines=$(wc -l < "$f")
            if [ "$lines" -gt "$MAX_HARD" ]; then
              echo "::error file=$f::$f has $lines lines (exceeds hard limit of $MAX_HARD)"
              ERRORS=$((ERRORS + 1))
            elif [ "$lines" -gt "$MAX_RECOMMENDED" ]; then
              echo "::warning file=$f::$f has $lines lines (exceeds recommended $MAX_RECOMMENDED)"
              WARNINGS=$((WARNINGS + 1))
            fi
          done

          echo ""
          echo "=== Nix Files ==="
          for f in $(find . -name "*.nix" -not -path "./node_modules/*" -not -path "./.git/*" | sort); do
            lines=$(wc -l < "$f")
            if [ "$lines" -gt "$MAX_HARD" ]; then
              echo "::error file=$f::$f has $lines lines (exceeds hard limit of $MAX_HARD)"
              ERRORS=$((ERRORS + 1))
            elif [ "$lines" -gt "$MAX_RECOMMENDED" ]; then
              echo "::warning file=$f::$f has $lines lines (exceeds recommended $MAX_RECOMMENDED)"
              WARNINGS=$((WARNINGS + 1))
            fi
          done

          echo ""
          echo "Summary: $ERRORS errors, $WARNINGS warnings"

          # Only fail on hard errors, warnings are informational
          if [ $ERRORS -gt 0 ]; then
            echo "Files exceeding $MAX_HARD lines must be refactored"
            exit 1
          fi

          echo "File length check passed"
